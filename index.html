<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ex-Servicemen Security Guards Arrears Calculator - NIT Patna</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { text-align: center; }
        form { max-width: 600px; margin: 0 auto; }
        label { display: block; margin-top: 10px; }
        input { width: 100%; padding: 8px; margin-top: 5px; }
        button { display: block; width: 100%; padding: 10px; margin-top: 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .violation { color: red; }
        #total-arrears { font-weight: bold; margin-top: 20px; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>Ex-Servicemen Security Guards Arrears Calculator</h1>
    <p>This tool allows you to input your date of joining and consolidated pay received each month. It analyzes violations based on DGR/CLC minimum wages for NIT Patna, calculates underpayments, and generates a PDF for claiming arrears.</p>
    
    <form id="inputForm">
        <label for="name">Your Name:</label>
        <input type="text" id="name" required>
        
        <label for="aadhaar">Aadhaar Number:</label>
        <input type="text" id="aadhaar" required pattern="\d{12}" placeholder="Enter 12-digit Aadhaar number" title="Aadhaar must be 12 digits">
        
        <label for="bankAccount">Indian Bank Salary Account No.:</label>
        <input type="text" id="bankAccount" required pattern="\d{9,18}" placeholder="Enter 9-18 digit account number" title="Account number must be 9-18 digits">
        
        <label for="dob">Date of Birth (YYYY-MM-DD):</label>
        <input type="date" id="dob" required>
        
        <label for="mobile">Mobile Number:</label>
        <input type="tel" id="mobile" required pattern="\d{10}" placeholder="Enter 10-digit mobile number" title="Mobile must be 10 digits">
        
        <label for="email">Email Address:</label>
        <input type="email" id="email" required>
        
        <label for="joiningDate">Date of Joining (YYYY-MM-DD):</label>
        <input type="date" id="joiningDate" required>
        
        <button type="button" onclick="generateMonths()">Generate Months & Input Pays</button>
    </form>
    
    <div id="tableContainer" style="display: none;">
        <table id="payTable">
            <thead>
                <tr>
                    <th>Month (YYYY-MM)</th>
                    <th>Required Total Wages (as per DGR/CLC)</th>
                    <th>Consolidated Pay Received</th>
                    <th>Difference (Underpayment)</th>
                    <th>Violation</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <div id="total-arrears"></div>
        <button type="button" onclick="generatePDF()">Generate Arrears Claim PDF</button>
    </div>

    <script>
        const wageData = [
            { start: '2013-10', totalWages: 15661.71 },
            { start: '2014-04', totalWages: 18696.00 },
            { start: '2014-10', totalWages: 19697.42 },
            { start: '2015-04', totalWages: 20834.98 },
            { start: '2015-10', totalWages: 21103.70 },
            { start: '2016-04', totalWages: 21349.27 },
            { start: '2016-10', totalWages: 21753.36 },
            { start: '2017-04', totalWages: 36594.29 },
            { start: '2017-10', totalWages: 37660.23 },
            { start: '2018-04', totalWages: 38866.88 },
            { start: '2018-10', totalWages: 39674.54 },
            { start: '2019-04', totalWages: 41206.44 },
            { start: '2019-10', totalWages: 41862.98 },
            { start: '2020-04', totalWages: 43516.58 },
            { start: '2020-10', totalWages: 44165.76 },
            { start: '2021-02', totalWages: 44165.76 },
            { start: '2021-10', totalWages: 46028.56 },
            { start: '2022-04', totalWages: 45541.67 },
            { start: '2022-10', totalWages: 48462.99 },
            { start: '2023-04', totalWages: 49977.75 },
            { start: '2023-10', totalWages: 50618.35 },
            { start: '2024-04', totalWages: 52466.28 },
            { start: '2024-10', totalWages: 52790.87 },
            { start: '2025-04', totalWages: 52423.25 },
            { start: '2025-10', totalWages: 54143.33 }
        ];

        function getTotalWagesForMonth(yearMonth) {
            const targetDate = new Date(`${yearMonth}-01`);
            let applicable = wageData[0].totalWages;
            for (let i = wageData.length - 1; i >= 0; i--) {
                const startDate = new Date(`${wageData[i].start}-01`);
                if (startDate <= targetDate) {
                    applicable = wageData[i].totalWages;
                    break;
                }
            }
            return applicable;
        }

        function generateMonths() {
            const joiningDate = new Date(document.getElementById('joiningDate').value);
            const currentDate = new Date('2025-10-04');
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            let current = new Date(joiningDate.getFullYear(), joiningDate.getMonth(), 1);
            
            while (current <= currentDate) {
                const yearMonth = `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}`;
                const requiredTotalWages = getTotalWagesForMonth(yearMonth);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${yearMonth}</td>
                    <td>${requiredTotalWages.toFixed(2)}</td>
                    <td><input type="number" class="paid-input" value="0" onchange="calculateDifference(this)"></td>
                    <td class="difference">0.00</td>
                    <td class="violation"></td>
                `;
                tableBody.appendChild(row);
                
                current.setMonth(current.getMonth() + 1);
            }
            
            document.getElementById('tableContainer').style.display = 'block';
            calculateAllDifferences();
        }

        function calculateDifference(input) {
            const row = input.parentElement.parentElement;
            const required = parseFloat(row.children[1].textContent);
            const paid = parseFloat(input.value) || 0;
            const diff = required - paid;
            row.children[3].textContent = diff.toFixed(2);
            row.children[4].textContent = diff > 0 ? 'Violation: Underpaid' : 'No Violation';
            row.children[4].classList.toggle('violation', diff > 0);
            calculateTotalArrears();
        }

        function calculateAllDifferences() {
            const inputs = document.querySelectorAll('.paid-input');
            inputs.forEach(input => calculateDifference(input));
        }

        function calculateTotalArrears() {
            const diffs = document.querySelectorAll('.difference');
            let total = 0;
            diffs.forEach(diff => {
                total += parseFloat(diff.textContent) || 0;
            });
            document.getElementById('total-arrears').textContent = `Total Arrears: ₹${total.toFixed(2)}`;
            return total;
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const name = document.getElementById('name').value;
            const aadhaar = document.getElementById('aadhaar').value;
            const bankAccount = document.getElementById('bankAccount').value;
            const dob = document.getElementById('dob').value;
            const mobile = document.getElementById('mobile').value;
            const email = document.getElementById('email').value;
            const joiningDate = document.getElementById('joiningDate').value;
            const totalArrears = calculateTotalArrears();

            // Set font to Times (closest approximation in jsPDF)
            doc.setFont('times');
            doc.setFontSize(12);

            // Initial setup
            let y = 10;
            const pageHeight = 297; // A4 height in mm
            const margin = 10;
            const lineHeight = 7;
            const maxY = pageHeight - margin;

            // Header
            doc.setFontSize(16);
            doc.text('Arrears Claim Letter', 105, y, { align: 'center' });
            y += 10;

            // Additional Personal Details
            doc.setFontSize(12);
            doc.text(`Name: ${name}`, margin, y);
            y += lineHeight;
            doc.text(`Aadhaar Number: ${aadhaar}`, margin, y);
            y += lineHeight;
            doc.text(`Indian Bank Salary Account No.: ${bankAccount}`, margin, y);
            y += lineHeight;
            doc.text(`Date of Birth: ${dob}`, margin, y);
            y += lineHeight;
            doc.text(`Mobile Number: ${mobile}`, margin, y);
            y += lineHeight;
            doc.text(`Email Address: ${email}`, margin, y);
            y += lineHeight;
            doc.text(`To: The Director, NIT Patna`, margin, y);
            y += lineHeight;
            doc.text(`From: ${name}`, margin, y);
            y += lineHeight;
            doc.text(`Date of Joining: ${joiningDate}`, margin, y);
            y += lineHeight;
            doc.text(`Subject: Claim for Arrears Due to Violations of DGR Minimum Wages, Non-Provision of EPF, and Other Allowances`, margin, y);
            y += 2 * lineHeight;

            // Body
            doc.text(`Dear Sir/Madam,`, margin, y);
            y += lineHeight;
            doc.text(`I am an ex-serviceman security guard employed directly by NIT Patna through the Sainik Kalyan Board, AWPO Danapur.`, margin, y);
            y += lineHeight;
            doc.text(`I hereby claim the following arrears based on underpayments and violations:`, margin, y);
            y += 2 * lineHeight;

            // Table Headers
            const headers = ['Month', 'Required Total Wages', 'Paid', 'Difference', 'Violation'];
            const startX = margin;
            const colWidth = 35; // Adjusted for better spacing
            headers.forEach((header, index) => {
                doc.text(header, startX + (index * colWidth), y, { maxWidth: colWidth - 2 });
            });
            y += lineHeight;

            // Table Data
            const rows = document.querySelectorAll('#payTable tbody tr');
            rows.forEach(row => {
                const cells = row.children;
                const rowData = [
                    cells[0].textContent,
                    cells[1].textContent,
                    cells[2].querySelector('input').value || '0',
                    cells[3].textContent,
                    cells[4].textContent
                ];

                if (y + lineHeight > maxY) {
                    doc.addPage();
                    y = margin + 10; // Reset y with margin
                    headers.forEach((header, index) => {
                        doc.text(header, startX + (index * colWidth), y, { maxWidth: colWidth - 2 });
                    });
                    y += lineHeight;
                }

                rowData.forEach((data, index) => {
                    doc.text(data.toString(), startX + (index * colWidth), y, { maxWidth: colWidth - 2 });
                });
                y += lineHeight;
            });

            // Footer
            if (y + (4 * lineHeight) > maxY) {
                doc.addPage();
                y = margin + 10;
            }
            y += lineHeight;
            doc.text(`Total Arrears: ₹${totalArrears.toFixed(2)}`, margin, y);
            y += lineHeight;
            doc.text(`Please release the arrears at the earliest.`, margin, y);
            y += lineHeight;
            doc.text(`Yours sincerely,`, margin, y);
            y += lineHeight;
            doc.text(name, margin, y);

            doc.save('arrears-claim.pdf');
        }
    </script>
</body>
</html>
